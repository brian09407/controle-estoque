<script>
  const API_SHEETS = 'https://script.google.com/macros/s/AKfycby5qjK7bnWzCGpdU1isAwYLn5QNsQgrBOBoAoYjtw1yXjZ7QnFS70Mz3qDdcOE8fGxp/exec';

  const lojas = [
    "Brandshouse Platinum", "Ellus Barra Sul", "Ellus Iguatemi", "Ellus Praia de Belas",
    "Richards Iguatemi", "Richards Moinhos", "Richards Barra Sul",
    "Tommy Platinum", "VR Barra Sul", "VR Iguatemi"
  ];

  const materiaisIniciais = [
    { nome: "Lâmpada AR111 - 3000k Ledvance", quantidade: 10 },
    { nome: "Lâmpada PAR30 - 28w - 3000k Ledvance", quantidade: 8 },
    { nome: "Fita de LED 5m - 3000k", quantidade: 5 },
    { nome: "Driver 12V 60W", quantidade: 6 },
    { nome: "Placa de LED 18w Embutir", quantidade: 12 }
  ];

  function inicializarEstoque() {
    let estoque = getEstoque();
    let atualizado = false;

    lojas.forEach(loja => {
      if (!estoque[loja]) {
        estoque[loja] = JSON.parse(JSON.stringify(materiaisIniciais));
        atualizado = true;
      }
    });

    if (atualizado) {
      salvarEstoque(estoque);
    }
  }

  function getEstoque() {
    return JSON.parse(localStorage.getItem("estoque_por_loja")) || {};
  }

  function salvarEstoque(estoque) {
    localStorage.setItem("estoque_por_loja", JSON.stringify(estoque));
  }

  function carregarMateriais() {
    const loja = document.getElementById("loja").value;
    const estoque = getEstoque();
    const materiais = estoque[loja] || [];

    const select = document.getElementById("material");
    select.innerHTML = '<option value="">Selecione o material</option>';

    materiais.forEach(m => {
      const option = document.createElement("option");
      option.value = m.nome;
      option.textContent = m.nome;
      select.appendChild(option);
    });

    atualizarTabela();
  }

  window.onload = () => {
    inicializarEstoque(); // <<<<<<<<<<<<<<<<<< ADICIONEI ISSO
    atualizarHistorico();
  };
</script>
